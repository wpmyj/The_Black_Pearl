
#include "temperature.h"
#include "bsp_usart.h"

extern float ADC_ConvertedValueLocal[4];

double temperature_R[151] = {

0.325, 0.335, 0.345, 0.355, 0.366, 0.377, 0.389, 0.4, 0.413, 0.426, 
//11 
0.439, 0.452, 0.467, 0.481, 0.496, 0.512, 0.528, 0.545, 0.563, 0.581, 
//21 
0.6, 0.619, 0.639, 0.66, 0.682, 0.704, 0.727, 0.752, 0.777, 0.803,
//31 
0.83, 0.858, 0.887, 0.917, 0.949, 1, 1.015, 1.05, 1.087, 1.125, 
//41
1.165, 1.206, 1.248, 1.293, 1.339, 1.387, 1.437, 1.489, 1.543, 1.6, 
//51  
1.658, 1.72, 1.783, 1.85, 1.919, 1.991, 2.066, 2.144, 2.226, 2.311, 
//61 
2.4, 2.492, 2.589, 2.689, 2.795, 2.904, 3.019, 3.139, 3.264, 3.394, 
//71  
3.531, 3.674, 3.823, 3.979, 4.142, 4.312, 4.491, 4.677, 4.873, 5.077, 
//81  
5.291, 5.516, 5.751, 5.997, 6.255, 6.525, 6.809, 7.106, 7.418, 
//91 
7.745, 8.089, 8.449, 8.827, 9.225, 9.642, 10, 10.542, 11.026, 11.535, 
12.071, 12.635, 13.228, 13.852, 14.509, 15.201, 15.93, 16.698, 17.508, 
18.362, 19.262, 20.211, 21.213, 22.271, 23.388, 24.567, 25.813, 27.13,
28.522, 29.994, 31.552, 33.199, 34.944, 36.791, 38.747, 40.821, 43.018, 
45.349, 47.821, 50.444, 53.228, 56.186, 59.327, 62.666, 66.216, 69.993, 
74.011, 78.288, 82.844, 87.697, 92.871, 98.389, 104.275, 110.558, 117.268, 
124.437, 132.1, 140.295, 149.064, 158.452, 168.507, 179.284,  

};

//int temperature_number[151]=
//{
// -30	, -29	, -28	, -27	, -26	, -25	, -24	, -23	, -22	, -21	, 
//-20	, -19	, -18	, -17	, -16	, -15	, -14	, -13	, -12	, -11	, -10	, 
//-9	, -8	, -7	, -6	, -5	, -4	, -3	, -2	, -1	, 0	,
// 1	, 2	, 3	, 4	, 5	, 6	, 7	, 8	, 9	, 10	,
// 11	, 12	, 13	, 14	, 15	, 16	, 17	, 18	, 19	, 20	, 
// 21	, 22	, 23	, 24	, 25	, 26	, 27	, 28	, 29	, 30	,
// 31	, 32	, 33	, 34	, 35	, 36	, 37	, 38	, 39	, 40	,
// 41	, 42	, 43	, 44	, 45	, 46	, 47	, 48	, 49	, 50	, 
// 51	, 52	, 53	, 54	, 55	, 56	, 57	, 58	, 59	, 60	,
// 61	, 62	, 63	, 64	, 65	, 66	, 67	, 68	, 69	, 70	, 
// 71	, 72	, 73	, 74	, 75	, 76	, 77	, 78	, 79	, 80	,
// 81	, 82	, 83	, 84	, 85	, 86	, 87	, 88	, 89	, 90	, 
// 91	, 92	, 93	, 94	, 95	, 96	, 97	, 98	, 99	, 100	, 
// 101	, 102	, 103	, 104	, 105	, 106	, 107	, 108	, 109	, 110	,
// 111	, 112	, 113	, 114	, 115	, 116	, 117	, 118	, 119	, 120	,
//};


/*
*二分法检测温度大小
*/

int binary( double *a, double key, int n )
{
    int left = 0, right = n - 1, mid = 0;
    mid = ( left + right ) / 2;
    while(left <= right)
    {
        if( a[mid] < key )
        left = mid + 1;
        else if( a[mid] > key )
        right = mid - 1;
        mid = ( left + right ) / 2;
    } 
	return mid + 1;
}


int Get_Temperature(void)
{
	double R;
	int local_where;
	R =	33.3 / ADC_ConvertedValueLocal[3] - 10.0;
//	printf("------------------------ADC_ConvertedValueLocal[3] = %f\r\n", ADC_ConvertedValueLocal[3]);
	local_where = binary(temperature_R, R , 151);
//	printf("------------------------local_where  = %d   R = %f\r\n", local_where , R);
	
//	printf("------------------------temperature_number[local_where] = %d \r\n", temperature_number[151 - local_where]);
	
	
	//	return temperature_number[151 - local_where]; // 此处可更改，去除那一堆数据
	return 151 - local_where -30;
}

